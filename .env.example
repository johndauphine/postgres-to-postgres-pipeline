# =============================================================================
# PostgreSQL to PostgreSQL Migration Pipeline Configuration
# =============================================================================
# Copy this file to .env and update values as needed.
# All settings below are environment variables that configure Airflow and the
# migration pipeline for your specific hardware and database setup.

# =============================================================================
# DATABASE CONNECTIONS
# =============================================================================
# Format: AIRFLOW_CONN_{CONN_ID}='{conn_type}://{login}:{password}@{host}:{port}/{schema}'
#
# The host can be:
#   - Docker container name: postgres-source (for local Docker Compose setup)
#   - Local IP address: 192.168.1.100 (for databases on your network)
#   - Hostname: db.internal.company.com (for internal DNS)
#   - Cloud endpoint: mydb.abc123.us-east-1.rds.amazonaws.com (for AWS RDS)
#   - localhost:5434 (for local PostgreSQL with port mapping)
#
# Examples for different environments:

# --- Docker Compose (default local development) ---
AIRFLOW_CONN_POSTGRES_SOURCE='postgresql://postgres:PostgresPassword123@postgres-source:5432/source_db'
AIRFLOW_CONN_POSTGRES_TARGET='postgresql://postgres:PostgresPassword123@postgres-target:5432/target_db'

# --- Local network databases ---
# AIRFLOW_CONN_POSTGRES_SOURCE='postgresql://app_user:SecurePass@192.168.1.50:5432/production_db'
# AIRFLOW_CONN_POSTGRES_TARGET='postgresql://app_user:SecurePass@192.168.1.51:5432/warehouse_db'

# --- Cloud databases (AWS RDS example) ---
# AIRFLOW_CONN_POSTGRES_SOURCE='postgresql://admin:RDSPassword@source-db.abc123.us-east-1.rds.amazonaws.com:5432/myapp'
# AIRFLOW_CONN_POSTGRES_TARGET='postgresql://admin:RDSPassword@target-db.xyz789.us-west-2.rds.amazonaws.com:5432/analytics'

# --- Mixed environment (Docker source, remote target) ---
# AIRFLOW_CONN_POSTGRES_SOURCE='postgresql://postgres:PostgresPassword123@postgres-source:5432/source_db'
# AIRFLOW_CONN_POSTGRES_TARGET='postgresql://app_user:SecurePass@prod-warehouse.company.com:5432/warehouse'

# =============================================================================
# AIRFLOW VARIABLES
# =============================================================================
AIRFLOW_VAR_TARGET_SCHEMA='public'

# =============================================================================
# HARDWARE PRESETS
# =============================================================================
# Choose ONE preset below based on your system RAM and uncomment the values.
# The default values are optimized for 32GB systems with Docker Desktop / WSL2.

# --- 8GB RAM (minimal / CI environments) ---
# AIRFLOW__CORE__PARALLELISM=4
# AIRFLOW__CORE__MAX_ACTIVE_TASKS_PER_DAG=2
# AIRFLOW__CORE__MAX_ACTIVE_RUNS_PER_DAG=1
# MAX_PARTITIONS=2
# PG_POOL_MINCONN=1
# PG_POOL_MAXCONN=2

# --- 16GB RAM (standard development laptop) ---
# AIRFLOW__CORE__PARALLELISM=8
# AIRFLOW__CORE__MAX_ACTIVE_TASKS_PER_DAG=4
# AIRFLOW__CORE__MAX_ACTIVE_RUNS_PER_DAG=1
# MAX_PARTITIONS=4
# PG_POOL_MINCONN=1
# PG_POOL_MAXCONN=4

# --- 32GB RAM (default - Docker Desktop / WSL2) ---
# Benchmarked optimal for virtualized filesystem I/O
AIRFLOW__CORE__PARALLELISM=16
AIRFLOW__CORE__MAX_ACTIVE_TASKS_PER_DAG=8
AIRFLOW__CORE__MAX_ACTIVE_RUNS_PER_DAG=1
MAX_PARTITIONS=8
PG_POOL_MINCONN=1
PG_POOL_MAXCONN=8

# --- 64GB+ RAM (dedicated server / production) ---
# AIRFLOW__CORE__PARALLELISM=32
# AIRFLOW__CORE__MAX_ACTIVE_TASKS_PER_DAG=16
# AIRFLOW__CORE__MAX_ACTIVE_RUNS_PER_DAG=1
# MAX_PARTITIONS=12
# PG_POOL_MINCONN=2
# PG_POOL_MAXCONN=16

# --- Apple Silicon (M1/M2/M3 Pro/Max with 32GB+) ---
# Apple's native virtualization has minimal overhead compared to WSL2/Hyper-V.
# M3 Max benchmarks show 40-50% higher throughput than equivalent WSL2 setup.
# AIRFLOW__CORE__PARALLELISM=24
# AIRFLOW__CORE__MAX_ACTIVE_TASKS_PER_DAG=12
# AIRFLOW__CORE__MAX_ACTIVE_RUNS_PER_DAG=1
# MAX_PARTITIONS=10
# PG_POOL_MINCONN=2
# PG_POOL_MAXCONN=12

# =============================================================================
# ENVIRONMENT VARIABLE REFERENCE
# =============================================================================
#
# AIRFLOW PARALLELISM:
#   AIRFLOW__CORE__PARALLELISM         - Maximum concurrent task instances globally
#   AIRFLOW__CORE__MAX_ACTIVE_TASKS_PER_DAG - Maximum concurrent tasks per DAG
#   AIRFLOW__CORE__MAX_ACTIVE_RUNS_PER_DAG  - Maximum concurrent DAG runs
#
# MIGRATION PIPELINE:
#   MAX_PARTITIONS     - Maximum partitions per large table (env default for DAG param)
#   PG_POOL_MINCONN    - Minimum PostgreSQL connections per pool
#   PG_POOL_MAXCONN    - Maximum PostgreSQL connections per pool
#
# PERFORMANCE NOTES:
#   - Higher parallelism != faster migrations in virtualized environments
#   - Docker Desktop/WSL2 has I/O overhead that causes contention at high parallelism
#   - The 32GB preset was benchmarked to be optimal for WSL2 with 8 concurrent tasks
#   - For bare-metal or dedicated VMs, try the 64GB+ preset even on 32GB systems
